<%= form_for([current_user, @item]) do |f| %>
  <h4 class="title">アイテム情報の入力</h4>
  <div>
    <div class="form-group">
      <%= f.label 'アイテム名' %><br>
      <%= f.text_field :item_name, class: 'form-control', maxlength: '19' %>
    </div>
    <div class="form-group">
      <%= f.label 'メーカー' %><br>
      <%= f.text_field :maker, class: 'form-control' %>
    </div>
    <div class="form-group">
      <%= f.label 'イメージ' %><br>
      <%= f.file_field :image %>
      <%= check_box_tag 'use_rakuten' %>
      <%= f.label '画像を自動取得する' %><small> *Powered_by rakuten-api</small>
    </div>
      <%= f.fields_for :locations do |b| %>
      <%= b.hidden_field :latitude  %>
      <%= b.hidden_field :longitude  %>
    <% end %>
    <%= f.submit "Submit", class: "btn btn-primary", id: "new_item", data: { 'loading-text' => "Loading..." } %>
  </div>
    <% end %>
  </div>
</div>

<script>
$('#myButton').on('click', function () {
  var $btn = $(this).button('loading')
      var options = {
          enableHighAccuracy: true ,
          timeout: 100000,
          maximumAge: 0
      };
      window.navigator.geolocation.getCurrentPosition(success, error, options);
    function success(pos) {
        document.getElementById('item_locations_attributes_0_latitude').value = pos.coords.latitude;
        document.getElementById('item_locations_attributes_0_longitude').value = pos.coords.longitude;
        $("#new_item").submit();
    }
    function error(err) {
      alert("位置情報が取得できませんでした。\n ページを更新するか、端末を変えてください。")
    }
});
</script>
